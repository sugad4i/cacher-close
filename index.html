<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>キャッシャー集計 ver1.07</title>
<link rel="apple-touch-icon" href="icon.png">
<style>
  body{font-family:monospace;margin:20px}
  #head{display:flex;justify-content:space-between;align-items:center;
        border-bottom:1px solid #ccc;padding-bottom:8px}
  table{border-collapse:collapse;margin-top:14px;width:100%}
  th,td{border:1px solid #aaa;padding:4px 8px;text-align:right}
  th{background:#eee;text-align:center}
  td:first-child,th:first-child{text-align:left}
  input[type=number]{width:70px;text-align:right}
  #summary{white-space:pre;margin-top:18px}
  #yenBox{font-size:18px;font-weight:bold;margin:12px 0;line-height:1.4}
  #tplBox{margin-top:10px}
  #tplBox button{margin-right:8px}
  #warn{color:#c00;font-weight:bold;margin-top:4px}
</style>
</head>
<body>

<div id="head">
  <h1>キャッシャー集計 ver1.07</h1>
  <span id="upd"></span>
</div>

<!-- 金額表示 -->
<div id="yenBox">
  手入力×人数 合計: <span id="yenInput">0</span> 円<br>
  CSV販売総売上合計: <span id="yenCsv">0</span> 円
  <div id="warn"></div>
</div>

<input type="file" id="csv" accept=".csv">

<div id="tplBox">
  <strong>テンプレ:</strong>
  <button onclick="applyTpl('ARGO')">ARGO / WAYUP</button>
  <button onclick="applyTpl('ENCORE')">ENCORE / LOYAL</button>
</div>

<table id="tbl">
  <thead>
    <tr>
      <th>カテゴリ / 商品名</th>
      <th>人数</th>
      <th>単価(円)</th>
      <th>種類別合計(円)</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<div id="summary"></div>

<!-- 自由記入追加 -->
<div id="customAddBox">
  <button onclick="addCustomEntry()">+1行追加</button>
</div>

<button id="copy" onclick="copyTxt()">コピー</button>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
<script>
let customEntries = [];
function addCustomEntry(){
  const idx = customEntries.length;
  const nameId = `custom_name_${idx}`;
  const freeId = `custom_free_${idx}`;

  const line = document.createElement('div');
  line.innerHTML =
    `<input id="${nameId}" placeholder="名前" style="width:120px">
     (ゲスト0 フリー <input id="${freeId}" type="number" value="0" style="width:60px"> )`;
  document.getElementById('summary').appendChild(line);

  customEntries.push({ nameId, freeId });
}

function copyTxt(){
  const sg=+document.getElementById('sg')?.value||0;
  const sf=+document.getElementById('sf')?.value||0;
  let txt='キャッシャー〆\n\n';
  txt+=`総数:${total}(外国人${foreign}名)\n`;
  txt+=`M:${male} W:${female}\n\n`;
  txt+=`Door                :    ${door}\n`;
  txt+=`外国人Door             :    ${fdoor}\n`;
  txt+=`22:00-1:00 Door     :    ${doorLate}\n`;
  txt+=`22:00-1:00 外国人Door  :    ${fdoorLate}\n\n`;
  txt+=`店ゲスト          ${sg}\n`;
  txt+=`店フリー           ${sf}\n\n`;
  txt+='【店舗ゲスト/フリー】\n';
  Object.keys(shop).forEach(s=>{
    const g=shop[s].guest;
    const f=shop[s].free+shop[s].freeInp;
    txt+=`${s}\n  ${g+f}(ゲスト${g} フリー ${shop[s].freeInp})\n`;
  });
  if(customEntries.length){
    txt+='\n【自由記入】\n';
    customEntries.forEach(e=>{
      const name = document.getElementById(e.nameId)?.value || '[未記入]';
      const f    = +document.getElementById(e.freeId)?.value || 0;
      txt+=`${name}\n  ${f}(ゲスト0 フリー ${f})\n`;
    });
  }
  navigator.clipboard.writeText(txt)
    .then(()=>alert('コピー完了！'))
    .catch(()=>alert('コピー失敗…'));
}
</script>
</body>
</html>
