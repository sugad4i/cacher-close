<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>キャッシャー集計 ver0.55</title>
<style>
 body{font-family:monospace;margin:20px}
 #head{display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid #ccc;padding-bottom:8px}
 table{border-collapse:collapse;margin-top:14px;width:100%}
 th,td{border:1px solid #aaa;padding:4px 8px}
 th{background:#eee}
 input[type=number]{width:70px;text-align:right}
 #summary{white-space:pre;margin-top:18px}
 #yenBox{font-size:20px;font-weight:bold;margin-top:8px}
 #tplBox{margin-top:10px}
 #tplBox button{margin-right:8px}
</style>
</head>
<body>

<div id="head">
  <h1>キャッシャー集計 ver0.55</h1>
  <span id="upd"></span>
</div>

<input type="file" id="csv" accept=".csv">

<!-- テンプレートボタン -->
<div id="tplBox">
  <strong>単価テンプレ:</strong>
  <button onclick="applyTpl('ARGO')">ARGO / WAYUP</button>
  <button onclick="applyTpl('ENCORE')">ENCORE / LOYAL</button>
</div>

<table id="tbl">
  <thead>
    <tr><th>カテゴリ / 商品名</th><th>人数</th><th>単価(円)</th></tr>
  </thead>
  <tbody></tbody>
</table>

<div id="summary"></div>
<div id="yenBox">合計金額: <span id="yenTotal">0</span> 円</div>

<button id="copy" onclick="copyTxt()">コピー</button>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
<script>
/* ---------------- util ---------------- */
document.getElementById('upd').textContent =
  '更新 ' + new Date().toLocaleDateString();

const tbody   = document.querySelector('#tbl tbody');
const summary = document.getElementById('summary');
const yenSpan = document.getElementById('yenTotal');
const norm    = s=>s.replace(/22~1/g,'22-1').replace(/[ \u3000\t]+/g,' ').trim();

/* ===== 並び順テーブル（略…同内容） ===== */
const order22=[/* …省略：前ver0.54 と同じ… */];
const orderNorm=[/* …同上… */];
function sKey(l){/* …同上… */}

/* ===== 単価テンプレ =====
   ※数字は例です。現場の料金に合わせて書き換えてください。 */
const priceTpl = {
  ARGO・WAYUP : {               // ARGO / WAYUP 用
    '男性'                    : 1000,
    '女性'                    :  800,
    'ローカル男性'            : 1000,
    'ローカル女性'            :  800,
    'ローカル男性ゲスト'      :  700,
    'ローカル女性ゲスト'      :  500,
    '22-1 男性'              : 2000,
    '22-1 女性'              : 1600,
    '観光 男性'              : 1500,
    '観光 女性'              : 1300,
    'フリー'                  :    0
  },

  ENCORE・LOYAL : {            // ENCORE / LOYAL 用
    '男性'                    : 1200,
    '女性'                    : 1000,
    'ローカル男性'            : 1200,
    'ローカル女性'            : 1000,
    'ローカル男性ゲスト'      :  900,
    'ローカル女性ゲスト'      :  700,
    '22-1 男性'              : 2200,
    '22-1 女性'              : 1800,
    '観光 男性'              : 1700,
    '観光 女性'              : 1500,
    'フリー'                  :    0
  }
};

/* ---------------- 集計変数 ---------------- */
let rows=[],total=0,foreign=0,male=0,female=0;
let door=0,fdoor=0,doorLate=0,fdoorLate=0;
const shop={};

/* ========== CSV パート（ver0.54 と同じなので折り畳み） ========== */
document.getElementById('csv').addEventListener('change',e=>{ /* …略… */});
function parseCSV(d){/* …略… */}       // その他→商品名 ラベル化 も維持
function buildTable(){ /* …略… */ }
function buildSummary(){ /* …略… */ }
/* ================================================================ */

/* -------- 単価テンプレ適用 -------- */
function applyTpl(name){
  const tpl = priceTpl[name];
  if(!tpl){alert('テンプレ未定義');return;}

  /* 各行 input へ流し込む */
  tbody.querySelectorAll('tr').forEach(tr=>{
    const label = tr.firstChild.textContent.trim();
    const price = tpl[label];
    if(price!==undefined){
      tr.querySelector('input').value = price;
    }
  });
  calcMoney();           // 合計再計算
}

/* -------- 金額計算・コピーは変化なし -------- */
function calcMoney(){ /* …略… */ }
function copyTxt(){ /* …略… */ }
</script>
</body>
</html>
